document.addEventListener("DOMContentLoaded",(function(){document.getElementById("transcribe-btn");const t=document.getElementById("search-btn"),e=document.getElementById("search-input"),n=document.getElementById("status"),r=document.getElementById("controls"),s=document.getElementById("search-container"),o=document.getElementById("results-container"),c=document.getElementById("results-list"),a=document.getElementById("transcript-container"),i=document.getElementById("transcript-text");function m(t,e){let n=0;for(let r=0;r<e.length;r++)if(n+=e[r].text.length,t<n)return r;return-1}function u(t){chrome.tabs.query({active:!0,currentWindow:!0},(function(e){chrome.tabs.sendMessage(e[0].id,{action:"seek",timestamp:t})}))}function d(t){return`${Math.floor(t/60)}:${Math.floor(t%60).toString().padStart(2,"0")}`}chrome.tabs.query({active:!0,currentWindow:!0},(function(t){const e=t[0];e.url&&e.url.includes("youtube.com/watch")?chrome.tabs.sendMessage(t[0].id,{action:"ping"},(function(e){var o;chrome.runtime.lastError?n.textContent="Please refresh the YouTube page to activate the extension.":(n.textContent="Fetching video captions... This may take a moment.",r.classList.remove("hidden"),o=t[0].id,chrome.tabs.sendMessage(o,{action:"transcribe"},(function(t){var e;chrome.runtime.lastError?n.textContent="Error: Please refresh the YouTube page and try again.":t&&t.success?(n.textContent="Transcription complete!",s.classList.remove("hidden"),chrome.storage.local.set({currentTranscript:t.transcript,currentTranscriptSegments:t.segments}),t.transcript,e=t.segments,i.innerHTML="",e.forEach((t=>{const e=document.createElement("p");e.innerHTML=`<span class="timestamp">${d(t.start)}</span>: ${t.text}`,e.querySelector(".timestamp").addEventListener("click",(function(){u(t.start)})),i.appendChild(e)})),a.classList.remove("hidden")):n.textContent="Error transcribing video: "+(t?t.error:"Unknown error")})))})):n.textContent="Navigate to a YouTube video to use this extension."})),t.addEventListener("click",(function(){const t=e.value.trim().toLowerCase();t&&(chrome.runtime.sendMessage({action:"trackEvent",eventType:"search",eventData:{term:t}}),chrome.storage.local.get(["currentTranscript","currentTranscriptSegments"],(function(e){var r;e.currentTranscript&&e.currentTranscriptSegments?(r=function(t,e,n){const r=[],s=e.toLowerCase();let o,c=0;for(;-1!==(o=s.indexOf(t,c));){const a=m(o,n);if(-1!==a){const c=n[a],i=Math.max(0,o-50),m=Math.min(s.length,o+t.length+50);let u=e.substring(i,m);const l=o-i,g=l+t.length;r.push({timestamp:c.start,formattedTime:d(c.start),context:u,termStart:l,termEnd:g})}c=o+t.length}return r}(t,e.currentTranscript,e.currentTranscriptSegments),c.innerHTML="",0===r.length?c.innerHTML="<li>No results found</li>":r.forEach((t=>{const e=document.createElement("li"),n=t.context.substring(0,t.termStart),r=t.context.substring(t.termStart,t.termEnd),s=t.context.substring(t.termEnd);e.innerHTML=`\n          <span class="timestamp">${t.formattedTime}</span>: \n          ${n}<strong>${r}</strong>${s}\n        `,e.addEventListener("click",(function(){u(t.timestamp)})),c.appendChild(e)})),o.classList.remove("hidden")):n.textContent="No transcript available. Please transcribe the video first."})))})),e.addEventListener("keyup",(function(e){"Enter"===e.key&&t.click()}))}));